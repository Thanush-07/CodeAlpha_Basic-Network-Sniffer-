{% extends "head.html" %}

{% block title %}Cyberpunk Packet Sniffer{% endblock %}

{% block content %}
<div class="min-h-screen bg-gradient-to-br from-gray-900 via-black to-purple-900 text-neon-green font-mono p-6">
  <h1 class="text-4xl font-extrabold mb-6 text-center text-transparent bg-clip-text bg-gradient-to-r from-neon-green to-neon-cyan">
    ‚ö° CyberSniffer Dashboard ‚ö°
  </h1>

  <!-- Card container -->
  <div class="max-w-6xl mx-auto bg-gray-950 bg-opacity-70 border border-neon-green/50 rounded-2xl shadow-lg overflow-hidden">
    <div class="p-4 border-b border-neon-green/40 flex justify-between items-center">
      <span class="text-lg tracking-wide">üì° Live Network Packets</span>
      <span id="status" class="text-sm text-neon-cyan animate-pulse">Capturing...</span>
    </div>

    <!-- Table -->
    <div class="overflow-x-auto">
      <table class="w-full text-left">
        <thead>
          <tr class="bg-gradient-to-r from-green-700/40 to-cyan-700/40 text-neon-cyan uppercase text-xs">
            <th class="px-4 py-3">Source</th>
            <th class="px-4 py-3">Destination</th>
            <th class="px-4 py-3">Protocol</th>
            <th class="px-4 py-3">Payload</th>
          </tr>
        </thead>
        <tbody id="packetTable" class="divide-y divide-neon-green/20 text-sm"></tbody>
      </table>
    </div>
  </div>
</div>

<script>
async function fetchPackets() {
  try {
    let res = await fetch("/packets");
    let data = await res.json();

    let table = document.getElementById("packetTable");
    table.innerHTML = "";

    data.forEach(pkt => {
      let row = `<tr class="hover:bg-neon-purple/20 transition ease-in-out duration-200">
          <td class="px-4 py-2">${pkt.src}</td>
          <td class="px-4 py-2">${pkt.dst}</td>
          <td class="px-4 py-2 font-bold text-neon-cyan">${pkt.proto}</td>
          <td class="px-4 py-2 text-neon-green truncate max-w-xs">${pkt.payload}</td>
      </tr>`;
      table.innerHTML += row;
    });
  } catch (e) {
    document.getElementById("status").textContent = "‚ö†Ô∏è Error fetching packets";
    document.getElementById("status").classList.remove("animate-pulse");
  }
}

setInterval(fetchPackets, 2000);
</script>
{% endblock %}